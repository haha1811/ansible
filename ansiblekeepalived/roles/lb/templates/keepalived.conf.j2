global_defs {
    script_user root
    enable_script_security
}

vrrp_script chk_haproxy {
    script "/usr/bin/pgrep haproxy"
    interval 2
    fall 3
    rise 1
}

vrrp_instance VI_1 {
    state {{ keepalived_state }}
    interface ens5
    virtual_router_id 51
    priority {{ keepalived_priority }}
    advert_int 1

    authentication {
        auth_type PASS
        auth_pass 12345678
    }

    unicast_src_ip {{ keepalived_src_ip }}
    unicast_peer {
        {{ keepalived_peer_ip }}
    }

    virtual_ipaddress {
        10.100.2.100/24 dev ens5
    }

    track_script {
        chk_haproxy
    }
}

